@model IEnumerable<WEB2.Models.OrderDetail>

@{
    Layout = null;
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Thanh toán</title>
    <!-- Favico::afterfter icon -->
    <link recolorpe="image/png" sizes="16x16" href="~/images~/images/GoTech.vn_logo.png">

    <!--.step-form-horizontalForm step -->
    <link href="~/vendor/jquery-steps/css/jquery.steps.css" rel="stylesheet">
    <!-- Datatable -->
    <link href="~/vendor/datatables/css/jquery.dataTables.min.css" rel="stylesheet">
    <!-- Custom Stylesheet -->
    <link href="@Url.Content("/css/views/orderdetails/pay.css")" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <script src="@Url.Content("~/lib/jquery/dist/jquery.min.js")"></script>
    <script src="@Url.Content("~/lib/bootstrap/dist/js/bootstrap.bundle.min.js")"></script>
    <link href="@Url.Content("https://unpkg.com/boxicons@2.0.9/css/boxicons.min.css")" rel="stylesheet" type="text/css" />
    <link href="@Url.Content("https://cdn.jsdelivr.net/npm/bootstrap-icons@1.6.1/font/bootstrap-icons.css")" rel="stylesheet" type="text/css" />
    <link href="~/css/style.css" rel="stylesheet">
        <style>
        li[aria-disabled="false"] span.number {
            color: white !important;
            border: 2px solid #be1e2d !important;
            background-color: #be1e2d !important;
        }

        li[aria-disabled="true"] span.number {
            color: #be1e2d !important;
        }

        .welcome-text > h4 {
            color: #be1e2d;
        }

        .step-form-horizontal .wizard .steps li:not(:last-child)::after {
            background-color: #be1e2d;
        }

        a[href="#next"], a[href="#finish"] {
            background-color: #be1e2d !important;
            border-radius: 30px !important;
        }

        a[href="#previous"] {
            color: #454545 !important;
            background: #F7FAFC !important;
            border: 1px solid #EEEEEE;
            border-radius: 30px !important;
        }

        .text-label {
            color: rgba(85,85,85,.8) !important;
        }

        table {
            border-collapse: collapse !important;
            border-radius: 10px !important;
            border-style: hidden !important; /* hide standard table (collapsed) border */

            box-shadow: rgb(60 64 67 / 10%) 0px 1px 2px 0px, rgb(60 64 67 / 15%) 0px 2px 6px 2px !important;
        }

        tr > td:first-child {
            text-align: center;
            padding: 10px;
        }

        tr {
            color: #454545 !important;
        }

        table tr:first-child th:first-child {
            border-top-left-radius: 10px;
        }

        table tr:first-child th:last-child {
            border-top-right-radius: 10px;
        }

        table tr:last-child td:first-child {
            border-top-right-radius: 10px !important;
        }

        table tr:last-child td:last-child {
            border-bottom-right-radius: 10px;
        }

        th {
            background: #be1e2d;
            color: white;
        }

        th, td {
            padding: 1em;
            border-bottom: 0.5px solid rgb(60 64 67 / 17.5%);
        }

        tbody img {
            width: 72px !important;
            height: 72px !important;
            max-width: 72px !important;
            max-height: 72px !important;
        }

        .producttable {
            background-color: transparent !important;
            border-radius: 10px;
        }

        .card {
            box-shadow: none;
        }

        .stronger {
            font-weight: bold;
        }



            .phuongthucthanhtoan > div > div {
                display: inline-block;
            }

                .phuongthucthanhtoan > div > div:last-child {
                    min-width: 200px !important;
                }
        .page-titles {
            margin-top: 30px;
            background: #be1e2d;
            border-radius: 10px;
        }

            .page-titles h4 {
                color: white;
            }

        .breadcrumb a {
            color: white !important;
        }

        .breadcrumb-item + .breadcrumb-item::before {
            color: #ffffff !important;
        }

        .mainload > div > div {
            border-radius: 30px !important;
            box-shadow: rgb(60 64 67 / 10%) 0px 1px 2px 0px, rgb(60 64 67 / 15%) 0px 2px 6px 2px !important;
        }
        body {
            font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji" !important;
        }
        .logo {
            font-family: "Cabin", sans-serif;
            font-size: 200%;
            justify-content: center;
            display: flex;
            color: black;
        }
        header {
            border-bottom: 1px solid #D1D5DB;
        }
            .logo span {
                color: #be1e2d;
                display: inline-block;
            }

        .logo {
            display: inline-block;
            word-wrap: normal;
        }
    </style>
</head>
<body> 
    <header>
        <nav class="navbar navbar-expand-sm navbar-toggleable-sm navbar-light bg-white topnav">
            <div class="container">
                <a class="navbar-brand" asp-area="" asp-controller="Home" asp-action="Index">
                    <p class="logo mb-0">Tech<span style="color: #be1e2d">N</span></p>
                </a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target=".navbar-collapse" aria-controls="navbarSupportedContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                @await Html.PartialAsync("_LoginPartial")
            </div>
        </nav>
    </header>
    <!-- row -->
    <div class="container">
        <div class="container-fluid">
            <div class="row page-titles mx-0">
                <div class="col-sm-6 p-md-0">
                    <div class="welcome-text">
                        <h4>Thanh toán</h4>
                    </div>
                </div>
                <div class="col-sm-6 p-md-0 justify-content-sm-end mt-2 mt-sm-0 d-flex">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a asp-area="" asp-action="Index" asp-controller="OrderDetails">Giỏ hàng</a></li>
                        <li class="breadcrumb-item active"><a href="javascript:void(0)">Thanh toán</a></li>
                    </ol>
                </div>
            </div>
            <!-- row -->
            <div class="row mainload">
                <div class="col-xl-12 col-xxl-12">
                    <div class="card">
                        <div class="card-body">
                            <form asp-action="Payment" id="step-form-horizontal" class="step-form-horizontal">
                                <div>
                                    <h4>Thông tin giao hàng</h4>
                                    <section class="thongtincanhan">
                                        @foreach (var item in Model) {
                                            <div class="row">
                                                <div class="col-lg-6 mb-4">
                                                    <div class="form-group">
                                                        <label class="text-label">Họ & Tên người nhận</label>
                                                        <input asp-for="@item.Order.Customer.AppUser.FullName" style="width: 50%;" class="form-control" disabled />
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 mb-4">
                                                    <div class="form-group">
                                                        <label class="text-label">Tên tài khoản</label>
                                                        <input asp-for="@item.Order.Customer.AppUser.UserName"  style="width: 50%;" class="form-control" disabled />
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 mb-4">
                                                    <div class="form-group">
                                                        <label class="text-label">Email</label>
                                                        <div class="input-group">
                                                            <input asp-for="@item.Order.Customer.AppUser.Email" type="email" class="form-control" placeholder="email@domain.com" />
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 mb-4">
                                                    <div class="form-group">
                                                        <label class="text-label">Số điện thoại nhận hàng</label>
                                                        <div class="input-group">
                                                            <input asp-for="@item.Order.Customer.AppUser.PhoneNumber" id="phonenumber" type="text" name="phoneNumber" class="form-control" placeholder="(+84) 123-456-789" required>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="col-lg-6 mb-4">
                                                      <select id="tinh">
                                                        Chọn tỉnh
                                                        <option> TP Hồ Chí Minh</option>
                                                        <option> Hà Nội</option>
                                                        <option> Đà Nẵng</option>
                                                        <option> Hải Phòng</option>
                                                        <option> Hà Giang</option>
                                                        <option>Cao Bằng</option>
                                                        <option>Lai Châu</option>
                                                        <option>Tuyên Quang</option>
                                                        <option>Lạng Sơn</option>
                                                        <option>Bắc Kạn</option>
                                                        <option>Thái Nguyên</option>
                                                        <option>Yên Bái</option>
                                                        <option>Sơn La</option>
                                                        <option>Phú Thọ</option>
                                                        <option>Vĩnh Phúc</option>
                                                        <option>Quảng Ninh</option>
                                                        <option>Bắc Giang</option>
                                                        <option>Bắc Ninh</option>
                                                        <option>Hải Dương</option>
                                                        <option>Hưng Yên</option>
                                                        <option>Hòa Bình</option>
                                                        <option>Hà Nam</option>
                                                        <option>Nam Định</option>
                                                        <option>Thái Bình</option>
                                                        <option>Ninh Bình</option>
                                                        <option>Thanh Hóa</option>
                                                        <option>Nghệ An</option>
                                                        <option>Hà Tĩnh</option>
                                                        <option>Quảng Bình</option>
                                                        <option>Quảng trị</option>
                                                        <option>Thừa Thiên Huế</option>
                                                        <option>Quảng Nam</option>
                                                        <option>Quảng Ngãi</option>
                                                        <option>Kontum</option>
                                                        <option>Bình Định</option>
                                                        <option>Gia Lai</option>
                                                        <option>Phú Yên</option>
                                                        <option>Đắk Lắk</option>
                                                        <option>Khánh Hòa</option>
                                                        <option>Lâm Đồng</option>
                                                        <option>Bình Phước</option>
                                                        <option>Bình Dương</option>
                                                        <option>Ninh Thuận</option>
                                                        <option>Tây Ninh</option>
                                                        <option>Bình Thuận</option>
                                                        <option>Đồng Nai</option>
                                                        <option>Long An</option>
                                                        <option>Đồng Tháp</option>
                                                        <option>An Giang</option>
                                                        <option>Bà Rịa – VT</option>
                                                        <option>An Giang</option>
                                                        <option>Tiền Giang</option>
                                                        <option>Kiên Giang</option>
                                                        <option>Cần Thơ</option>
                                                        <option>Bến Tre</option>
                                                        <option>Vĩnh Long</option>
                                                        <option>Trà Vinh</option>
                                                        <option>Sóc Trăng</option>
                                                        <option>Bạc Liêu</option>
                                                        <option>Cà Mau</option>
                                                        <option>Điện Biên</option>
                                                        <option>Đắk Nông</option>
                                                        <option>Hậu Giang</option>
                                                    </select>
                                                </div>
                                                <div class="col-lg-6 mb-4">
                                                    <div class="form-group">
                                                        <label class="text-label">Địa chỉ giao hàng<span></span></label>
                                                        <input id="shipadd" asp-for="@item.Order.Customer.ShipAddress" type="text" name="place" class="form-control" required>
                                                    </div>
                                                </div>
                                            </div>
                                            break;
                                        }
                                    </section>
                                    <h4>Sản phẩm</h4>
                                    <section>
                                        <div class="col-12 producttable">

                                                        <table class="display producttable1" style="width:100%">
                                                            <thead>
                                                                <tr>
                                                                    <th></th>
                                                                    <th>Sản phẩm</th>
                                                                    <th>Giá</th>
                                                                    <th>Số lượng</th>
                                                                    <th>Thành tiền</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody>
                                                                @{
                                                                    double moneyItem = 0;
                                                                     double shipMoney = 0;
                                                                    double pay = 0;
                                                                    int orderid = 0;
                                                                }
                                                                @foreach (var item in Model) {
                                                                    <tr>
                                                                        <td>
                                                                            <img src="@Html.DisplayFor(modelItem => item.Product.Picture)" style="width: 96px; height: 96px ;max-width: 96px;max-height: 96px" />
                                                                        </td>
                                                                        <td>
                                                                            @Html.DisplayFor(modelItem => item.Product.ProductName)
                                                                        </td>
                                                                        <td class="stronger">
                                                                            @Html.DisplayFor(modelItem => item.Quantity)
                                                                        </td>
                                                                        <td  class="stronger pricecing0">
                                                                             @Html.DisplayFor(modelItem => item.Price)
                                                                        </td>

                                                                        <td  class="stronger pricecing1">
                                                                            @Html.DisplayFor(modelItem  => item.Total)
                                                                        </td>
                                                        </tr>
                                                        moneyItem += item.Total;
                                                        pay = moneyItem;
                                                        orderid = item.OrderId;
                                                        shipMoney = item.Order.Freight;
                                                    }
                                                            </tbody>
                                                        </table>
                                        </div>
                                        <div class="text-right tr" style="margin-right: 15px; margin-top: 35px; "><label class="text-label">Tạm tính:&nbsp;</label><span class="labels"><span class="tamtinh">@moneyItem</span><span>&nbsp;&#8363;</span></span></div>
                                        @*<div class="text-right text-danger card-title"> Tổng tiền: @pay<span>VND</span> </div>*@
                                    </section>
                                    <h4>Phương thức thanh toán</h4>
                                    <section>
                                        <div class="row">
                                            <div class="col-md-6">
                                            @foreach (var item in Model) {

                                                <div class="form-group">
                                                    <label class="control-label">Đơn vị vận chuyển</label>
                                                    <select id="ship" asp-for="@item.Order.Shipment.ShipperId" class="form-control" asp-items="ViewBag.ShipperId">
                                                    </select>
                                                    <span asp-validation-for="@item.Order.Shipment.ShipperId" class="text-danger"></span>
                                                </div>

                                                <div class="form-group">
                                                    <label class="control-label">Phương thức thanh toán</label>
                                                    <select id="typepay" asp-for="@item.Order.Payment.PaymentId" class="form-control" asp-items="ViewBag.PaymentId"></select>
                                                    <span asp-validation-for="@item.Order.Payment.PaymentId" class="text-danger"></span>
                                                </div>
                                                break;
                                            }
                                            </div>
                                            <div class="col-md-6">
                                                <div class="phuongthucthanhtoan">
                                                    <div class="text-right tr"><div><label class="text-label">Tổng tiền hàng</label></div><div><span class="tamtinh1">@moneyItem</span><span>&nbsp;&#8363;</span></div></div>
                                                    <div class="text-right tr"><div><label class="text-label">Phí vận chuyển</label></div><div><span id="shipmoney"></span><span>&nbsp;&#8363;</span></div></div>
                                                    <div class="text-right tr"><div><label class="text-label">Voucher từ TechN</label></div><div><span id="voucher"></span>0<span>&nbsp;&#8363;</span></div></div>
                                                    <div class="text-right"><div><label class="text-label">Tổng Số tiền</label></div><div><span class="labels"><span id="pay"></span><span>&nbsp;&#8363;</span></span></div></div>
                                                </div>
                                        </div>
                                    </div>
                                    </section>
                                    <h4>Khuyến mãi</h4>
                                    <section>
                                        <div>
                                            <div class="container mt-4" style="min-height: 100vh">
                                                <h1 style="text-align: center; color: #be1e2d">SẮP HOÀN TẤT</h1>
                                                <h1 style="text-align: center; color: green; font-size: 2.5rem"><i class="bi bi-check2-circle" style="font-size: 5.5rem"></i></h1>
                                                <p style="text-align: center; color: black;">Vui lòng chọn Hoàn Tất để quá trình xác nhận phương thức thanh toán được tiến hành<br />
                                                
                                                
                                            </div>
                                        </div>
                                        <a id="paid" href="@Url.Action("Payment","Orders", new {id = orderid})">Thanh toán</a>
                                        <script type="text/javascript">

                                               var ranarr = [];
                                                for (let i = 1 ; i < 8 ; ++i){
                                                        var ran =  Math.floor(Math.random() * 3000) + 2000;
                                                        ranarr.push(ran);
                                                }
                                                ranarr[1] = 0;
                                                var shipmoney =  @shipMoney;
                                                var total =  @pay + shipmoney;

                                                    var shipcom = 1;
                                                var oid = @orderid;
                                                document.getElementById("shipmoney").innerHTML = numberWithCommas(shipmoney);
                                                    document.getElementById("pay").innerHTML =  numberWithCommas(total);
                                            $('#ship').change(function () {

                                                var selectedValue = $(this).val();
                                                    shipcom =  selectedValue;
                                                    shipmoney =  @shipMoney+  ranarr[selectedValue];
                                                    total =  ranarr[selectedValue] + @pay + shipmoney;

                                                document.getElementById("shipmoney").innerHTML = numberWithCommas(shipmoney);

                                                    document.getElementById("pay").innerHTML = numberWithCommas(total);


                                            });
                                            var address =  document.getElementById('shipadd').value ;
                                            var types = $('#typepay').val();
                                                  $('#paid').hide();
                                            //if(types != 1){
                                            //            $('#paid').show();
                                            //        }


                                                $('#typepay').change(function () {
                                                    types =  $(this).val();

                                                    //if(types != 1){
                                                    //    $('#paid').show();
                                                    //}

                                            });


                                            console.log(address);
                                            $('#shipadd').change(function(){
                                                    address = $('#shipadd').val();
                                                        console.log(address);
                                            })  ;

                                            function check(){
                                                      if(types != 1){
                                                        $('#paid').show();
                                                    }

                                            }
                                            //di sản 

                                               function numberWithCommas(x) {
                                                var parts = x.toString().split(".");
                                                parts[0] = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, ".");
                                                return parts.join(",");
                                            }
                                            function updatetotal() {
                                                let totalPoints = 0;
                                                $("tr").find(".total-fld").each(function () {
                                                    let splited = $(this).html().split('.').join("");
                                                    totalPoints += parseInt(splited);
                                                });
                                                $("#m_total").html(numberWithCommas(totalPoints));
                                            }

                                            ///
                                            function submitForm() {
                                                                      
                                            var model = new Object();
                                            model.Orderid = oid;
                                            model.Shipaddress = address;
                                            model.Shippay = shipmoney;
                                            model.Paid = total;
                                            model.Shipcompany = shipcom;
                                            model.TypePay = types;
                                            model.Provi = $("#tinh").val();
                                            jQuery.ajax({
                                            type: "POST",
                                            url: "@Url.Action("Payment","OrderDetails")",
                                            dataType: "json",
                                            contentType: "application/json; charset=utf-8",
                                            data: JSON.stringify( model ),
                                            processData: true,
                                                    cache: false,
                                          }).done(function(data){
                                             alert("Thanh toán thành công");
                                             window.location.replace(data.newUrl);
                                          });
                               
                                           }

                                        </script>

                                    </section>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <!-- Form validate init -->
    <script src="~/js/plugins-init/jquery.validate-init.js"></script>

    <!-- Required vendors -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
            integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
            crossorigin="anonymous"></script>

    <!-- <script src="~/vendor/global/global.min.js"></script>          -->
    <script src="~/js/quixnav-init.js"></script>
    <script src="~/js/custom.min.js"></script>


    <!-- <script src="~/vendor/jquery-steps/build/step.js"></script>       -->

    <script type="text/javascript">
        $(document).ready(function(){
            $(".producttable1").ready(function(){
                $(this).find("tr").each(function () {
                    $(this).find(".pricecing0").html(numberWithCommas($(this).find(".pricecing0").text()))
                    $(this).find(".pricecing1").html(numberWithCommas($(this).find(".pricecing1").text()))
                })
            })
            $(".tamtinh").html(numberWithCommas($(".tamtinh").text()));
            $(".tamtinh1").html(numberWithCommas($(".tamtinh1").text()));
        })


        !(function (a, b) {
            function c(a, b) {
                o(a).push(b);
            }
            function d(d, e, f) {
                var g = d.children(e.headerTag),
                    h = d.children(e.bodyTag);
                g.length > h.length
                    ? R(Z, "contents")
                    : g.length < h.length && R(Z, "titles");
                var i = e.startIndex;
                if (((f.stepCount = g.length), e.saveState && a.cookie)) {
                    var j = a.cookie(U + q(d)),
                        k = parseInt(j, 0);
                    !isNaN(k) && k < f.stepCount && (i = k);
                }
                (f.currentIndex = i),
                    g.each(function (e) {
                        var f = a(this),
                            g = h.eq(e),
                            i = g.data("mode"),
                            j =
                                null == i
                                    ? $.html
                                    : r($, /^\s*$/.test(i) || isNaN(i) ? i : parseInt(i, 0)),
                            k = j === $.html || g.data("url") === b ? "" : g.data("url"),
                            l = j !== $.html && "1" === g.data("loaded"),
                            m = a.extend({}, bb, {
                                title: f.html(),
                                content: j === $.html ? g.html() : "",
                                contentUrl: k,
                                contentMode: j,
                                contentLoaded: l,
                            });
                        c(d, m);
                    });
            }
            function e(a) {
                a.triggerHandler("canceled");
            }
            function f(a, b) {
                return a.currentIndex - b;
            }
            function g(b, c) {
                var d = i(b);
                b
                    .unbind(d)
                    .removeData("uid")
                    .removeData("options")
                    .removeData("state")
                    .removeData("steps")
                    .removeData("eventNamespace")
                    .find(".actions a")
                    .unbind(d),
                    b.removeClass(c.clearFixCssClass + " vertical");
                var e = b.find(".content > *");
                e.removeData("loaded").removeData("mode").removeData("url"),
                    e
                        .removeAttr("id")
                        .removeAttr("role")
                        .removeAttr("tabindex")
                        .removeAttr("class")
                        .removeAttr("style")
                        ._removeAria("labelledby")
                        ._removeAria("hidden"),
                    b
                        .find(".content > [data-mode='async'],.content > [data-mode='iframe']")
                        .empty();
                var f = a(
                    '<{0} class="{1}"></{0}>'.format(b.get(0).tagName, b.attr("class"))
                ),
                    g = b._id();
                return (
                    null != g && "" !== g && f._id(g),
                    f.html(b.find(".content").html()),
                    b.after(f),
                    b.remove(),
                    f
                );
            }
            function h(a, b) {
                var c = a.find(".steps li").eq(b.currentIndex);
                a.triggerHandler("finishing", [b.currentIndex])
                    ? (c.addClass("done").removeClass("error"),
                        a.triggerHandler("finished", [b.currentIndex]))
                    : c.addClass("error");
            }
            function i(a) {
                var b = a.data("eventNamespace");
                return null == b && ((b = "." + q(a)), a.data("eventNamespace", b)), b;
            }
            function j(a, b) {
                var c = q(a);
                return a.find("#" + c + V + b);
            }
            function k(a, b) {
                var c = q(a);
                return a.find("#" + c + W + b);
            }
            function l(a, b) {
                var c = q(a);
                return a.find("#" + c + X + b);
            }
            function m(a) {
                return a.data("options");
            }
            function n(a) {
                return a.data("state");
            }
            function o(a) {
                return a.data("steps");
            }
            function p(a, b) {
                var c = o(a);
                return (0 > b || b >= c.length) && R(Y), c[b];
            }
            function q(a) {
                var b = a.data("uid");
                return (
                    null == b &&
                    ((b = a._id()),
                        null == b && ((b = "steps-uid-".concat(T)), a._id(b)),
                        T++,
                        a.data("uid", b)),
                    b
                );
            }
            function r(a, c) {
                if ((S("enumType", a), S("keyOrValue", c), "string" == typeof c)) {
                    var d = a[c];
                    return d === b && R("The enum key '{0}' does not exist.", c), d;
                }
                if ("number" == typeof c) {
                    for (var e in a) if (a[e] === c) return c;
                    R("Invalid enum value '{0}'.", c);
                } else R("Invalid key or value type.");
            }
            function s(a, b, c) {
                return B(a, b, c, v(c, 1));
            }
            function t(a, b, c) {
                return B(a, b, c, f(c, 1));
            }
            function u(a, b, c, d) {
                if (
                    ((0 > d || d >= c.stepCount) && R(Y),
                        !(b.forceMoveForward && d < c.currentIndex))
                ) {
                    var e = c.currentIndex;
                    return (
                        a.triggerHandler("stepChanging", [c.currentIndex, d])
                            ? ((c.currentIndex = d),
                                O(a, b, c),
                                E(a, b, c, e),
                                D(a, b, c),
                                A(a, b, c),
                                P(a, b, c, d, e, function () {
                                    a.triggerHandler("stepChanged", [d, e]);
                                }))
                            : a.find(".steps li").eq(e).addClass("error"),
                        !0
                    );
                }
            }
            function v(a, b) {
                return a.currentIndex + b;
            }
            function w(b) {
                var c = a.extend(!0, {}, cb, b);
                return this.each(function () {
                    var b = a(this),
                        e = {
                            currentIndex: c.startIndex,
                            currentStep: null,
                            stepCount: 0,
                            transitionElement: null,
                        };
                    b.data("options", c),
                        b.data("state", e),
                        b.data("steps", []),
                        d(b, c, e),
                        J(b, c, e),
                        G(b, c),
                        c.autoFocus && 0 === T && j(b, c.startIndex).focus(),
                        b.triggerHandler("init", [c.startIndex]);
                });
            }
            function x(b, c, d, e, f) {
                (0 > e || e > d.stepCount) && R(Y),
                    (f = a.extend({}, bb, f)),
                    y(b, e, f),
                    d.currentIndex !== d.stepCount &&
                    d.currentIndex >= e &&
                    (d.currentIndex++, O(b, c, d)),
                    d.stepCount++;
                var g = b.find(".content"),
                    h = a("<{0}>{1}</{0}>".format(c.headerTag, f.title)),
                    i = a("<{0}></{0}>".format(c.bodyTag));
                return (
                    (null == f.contentMode || f.contentMode === $.html) && i.html(f.content),
                    0 === e
                        ? g.prepend(i).prepend(h)
                        : k(b, e - 1)
                            .after(i)
                            .after(h),
                    K(b, d, i, e),
                    N(b, c, d, h, e),
                    F(b, c, d, e),
                    e === d.currentIndex && E(b, c, d),
                    D(b, c, d),
                    b
                );
            }
            function y(a, b, c) {
                o(a).splice(b, 0, c);
            }
            function z(b) {
                var c = a(this),
                    d = m(c),
                    e = n(c);
                if (d.suppressPaginationOnFocus && c.find(":focus").is(":input"))
                    return b.preventDefault(), !1;
                var f = { left: 37, right: 39 };
                b.keyCode === f.left
                    ? (b.preventDefault(), t(c, d, e))
                    : b.keyCode === f.right && (b.preventDefault(), s(c, d, e));
            }
            function A(b, c, d) {
                if (d.stepCount > 0) {
                    var e = d.currentIndex,
                        f = p(b, e);
                    if (!c.enableContentCache || !f.contentLoaded)
                        switch (r($, f.contentMode)) {
                            case $.iframe:
                                b.find(".content > .body")
                                    .eq(d.currentIndex)
                                    .empty()
                                    .html(
                                        '<iframe src="' +
                                        f.contentUrl +
                                        '" frameborder="0" scrolling="no" />'
                                    )
                                    .data("loaded", "1");
                                break;
                            case $.async:
                                var g = k(b, e)
                                    ._aria("busy", "true")
                                    .empty()
                                    .append(M(c.loadingTemplate, { text: c.labels.loading }));
                                a.ajax({ url: f.contentUrl, cache: !1 }).done(function (a) {
                                    g.empty().html(a)._aria("busy", "false").data("loaded", "1"),
                                        b.triggerHandler("contentLoaded", [e]);
                                });
                        }
                }
            }
            function B(a, b, c, d) {
                var e = c.currentIndex;
                if (
                    d >= 0 &&
                    d < c.stepCount &&
                    !(b.forceMoveForward && d < c.currentIndex)
                ) {
                    var f = j(a, d),
                        g = f.parent(),
                        h = g.hasClass("disabled");
                    return (
                        g._enableAria(),
                        f.click(),
                        e === c.currentIndex && h ? (g._enableAria(!1), !1) : !0
                    );
                }
                return !1;
            }
            function C(b) {
                b.preventDefault();
                var c = a(this),
                    d = c.parent().parent().parent().parent(),
                    f = m(d),
                    g = n(d),
                    i = c.attr("href");
                switch (i.substring(i.lastIndexOf("#") + 1)) {
                    case "cancel":
                        e(d);
                        break;
                    case "finish":
                        h(d, g);
                        break;
                    case "next":
                        s(d, f, g);
                        break;
                    case "previous":
                        t(d, f, g);
                }
            }
            function D(a, b, c) {
                if (b.enablePagination) {
                    var d = a.find(".actions a[href$='#finish']").parent(),
                        e = a.find(".actions a[href$='#next']").parent();
                    if (!b.forceMoveForward) {
                        var f = a.find(".actions a[href$='#previous']").parent();
                        f._enableAria(c.currentIndex > 0);
                    }
                    b.enableFinishButton && b.showFinishButtonAlways
                        ? (d._enableAria(c.stepCount > 0),
                            e._enableAria(c.stepCount > 1 && c.stepCount > c.currentIndex + 1))
                        : (d._showAria(
                            b.enableFinishButton && c.stepCount === c.currentIndex + 1
                        ),
                            e
                                ._showAria(0 === c.stepCount || c.stepCount > c.currentIndex + 1)
                                ._enableAria(
                                    c.stepCount > c.currentIndex + 1 || !b.enableFinishButton
                                ));
                }
            }
            function E(b, c, d, e) {
                var f = j(b, d.currentIndex),
                    g = a(
                        '<span class="current-info audible">' + c.labels.current + " </span>"
                    ),
                    h = b.find(".content > .title");
                if (null != e) {
                    var i = j(b, e);
                    i.parent().addClass("done").removeClass("error")._selectAria(!1),
                        h.eq(e).removeClass("current").next(".body").removeClass("current"),
                        (g = i.find(".current-info")),
                        f.focus();
                }
                f.prepend(g).parent()._selectAria().removeClass("done")._enableAria(),
                    h
                        .eq(d.currentIndex)
                        .addClass("current")
                        .next(".body")
                        .addClass("current");
            }
            function F(a, b, c, d) {
                for (var e = q(a), f = d; f < c.stepCount; f++) {
                    var g = e + V + f,
                        h = e + W + f,
                        i = e + X + f,
                        j = a.find(".title").eq(f)._id(i);
                    a
                        .find(".steps a")
                        .eq(f)
                        ._id(g)
                        ._aria("controls", h)
                        .attr("href", "#" + i)
                        .html(M(b.titleTemplate, { index: f + 1, title: j.html() })),
                        a.find(".body").eq(f)._id(h)._aria("labelledby", i);
                }
            }
            function G(a, b) {
                var c = i(a);
                a.bind("canceled" + c, b.onCanceled),
                    a.bind("contentLoaded" + c, b.onContentLoaded),
                    a.bind("finishing" + c, b.onFinishing),
                    a.bind("finished" + c, b.onFinished),
                    a.bind("init" + c, b.onInit),
                    a.bind("stepChanging" + c, b.onStepChanging),
                    a.bind("stepChanged" + c, b.onStepChanged),
                    b.enableKeyNavigation && a.bind("keyup" + c, z),
                    a.find(".actions a").bind("click" + c, C);
            }
            function H(a, b, c, d) {
                return 0 > d || d >= c.stepCount || c.currentIndex === d
                    ? !1
                    : (I(a, d),
                        c.currentIndex > d && (c.currentIndex--, O(a, b, c)),
                        c.stepCount--,
                        l(a, d).remove(),
                        k(a, d).remove(),
                        j(a, d).parent().remove(),
                        0 === d && a.find(".steps li").first().addClass("first"),
                        d === c.stepCount && a.find(".steps li").eq(d).addClass("last"),
                        F(a, b, c, d),
                        D(a, b, c),
                        !0);
            }
            function I(a, b) {
                o(a).splice(b, 1);
            }
            function J(b, c, d) {
                var e = '<{0} class="{1}">{2}</{0}>',
                    f = r(_, c.stepsOrientation),
                    g = f === _.vertical ? " vertical" : "",
                    h = a(
                        e.format(
                            c.contentContainerTag,
                            "content " + c.clearFixCssClass,
                            b.html()
                        )
                    ),
                    i = a(
                        e.format(
                            c.stepsContainerTag,
                            "steps " + c.clearFixCssClass,
                            '<ul role="tablist"></ul>'
                        )
                    ),
                    j = h.children(c.headerTag),
                    k = h.children(c.bodyTag);
                b
                    .attr("role", "application")
                    .empty()
                    .append(i)
                    .append(h)
                    .addClass(c.cssClass + " " + c.clearFixCssClass + g),
                    k.each(function (c) {
                        K(b, d, a(this), c);
                    }),
                    j.each(function (e) {
                        N(b, c, d, a(this), e);
                    }),
                    E(b, c, d),
                    L(b, c, d);
            }
            function K(a, b, c, d) {
                var e = q(a),
                    f = e + W + d,
                    g = e + X + d;
                c._id(f)
                    .attr("role", "tabpanel")
                    ._aria("labelledby", g)
                    .addClass("body")
                    ._showAria(b.currentIndex === d);
            }
            function L(a, b, c) {
                if (b.enablePagination) {
                    var d =
                        '<{0} class="actions {1}"><ul role="menu" aria-label="{2}">{3}</ul></{0}>',
                        e = '<li><a href="#{0}" role="menuitem">{1}</a></li>',
                        f = "";
                    b.forceMoveForward || (f += e.format("previous", b.labels.previous)),
                        (f += e.format("next", b.labels.next)),
                        b.enableFinishButton && (f += e.format("finish", b.labels.finish)),
                        b.enableCancelButton && (f += e.format("cancel", b.labels.cancel)),
                        a.append(
                            d.format(
                                b.actionContainerTag,
                                b.clearFixCssClass,
                                b.labels.pagination,
                                f
                            )
                        ),
                        D(a, b, c),
                        A(a, b, c);
                }
            }
            function M(a, c) {
                for (var d = a.match(/#([a-z]*)#/gi), e = 0; e < d.length; e++) {
                    var f = d[e],
                        g = f.substring(1, f.length - 1);
                    c[g] === b &&
                        R("The key '{0}' does not exist in the substitute collection!", g),
                        (a = a.replace(f, c[g]));
                }
                return a;
            }
            function N(b, c, d, e, f) {
                var g = q(b),
                    h = g + V + f,
                    j = g + W + f,
                    k = g + X + f,
                    l = b.find(".steps > ul"),
                    m = M(c.titleTemplate, { index: f + 1, title: e.html() }),
                    n = a(
                        '<li role="tab"><a id="' +
                        h +
                        '" href="#' +
                        k +
                        '" aria-controls="' +
                        j +
                        '">' +
                        m +
                        "</a></li>"
                    );
                n._enableAria(c.enableAllSteps || d.currentIndex > f),
                    d.currentIndex > f && n.addClass("done"),
                    e._id(k).attr("tabindex", "-1").addClass("title"),
                    0 === f
                        ? l.prepend(n)
                        : l
                            .find("li")
                            .eq(f - 1)
                            .after(n),
                    0 === f && l.find("li").removeClass("first").eq(f).addClass("first"),
                    f === d.stepCount - 1 &&
                    l.find("li").removeClass("last").eq(f).addClass("last"),
                    n.children("a").bind("click" + i(b), Q);
            }
            function O(b, c, d) {
                c.saveState && a.cookie && a.cookie(U + q(b), d.currentIndex);
            }
            function P(b, c, d, e, f, g) {
                var h = b.find(".content > .body"),
                    i = r(ab, c.transitionEffect),
                    j = c.transitionEffectSpeed,
                    k = h.eq(e),
                    l = h.eq(f);
                switch (i) {
                    case ab.fade:
                    case ab.slide:
                        var m = i === ab.fade ? "fadeOut" : "slideUp",
                            o = i === ab.fade ? "fadeIn" : "slideDown";
                        (d.transitionElement = k),
                            l[m](j, function () {
                                var b = a(this)._showAria(!1).parent().parent(),
                                    c = n(b);
                                c.transitionElement &&
                                    (c.transitionElement[o](j, function () {
                                        a(this)._showAria();
                                    })
                                        .promise()
                                        .done(g),
                                        (c.transitionElement = null));
                            });
                        break;
                    case ab.slideLeft:
                        var p = l.outerWidth(!0),
                            q = e > f ? -p : p,
                            s = e > f ? p : -p;
                        a.when(
                            l.animate({ left: q }, j, function () {
                                a(this)._showAria(!1);
                            }),
                            k
                                .css("left", s + "px")
                                ._showAria()
                                .animate({ left: 0 }, j)
                        ).done(g);
                        break;
                    default:
                        a.when(l._showAria(!1), k._showAria()).done(g);
                }
            }
            function Q(b) {
                b.preventDefault();
                var c = a(this),
                    d = c.parent().parent().parent().parent(),
                    e = m(d),
                    f = n(d),
                    g = f.currentIndex;
                if (c.parent().is(":not(.disabled):not(.current)")) {
                    var h = c.attr("href"),
                        i = parseInt(h.substring(h.lastIndexOf("-") + 1), 0);
                    u(d, e, f, i);
                }
                return g === f.currentIndex ? (j(d, g).focus(), !1) : void 0;
            }
            function R(a) {
                throw (
                    (arguments.length > 1 &&
                        (a = a.format(Array.prototype.slice.call(arguments, 1))),
                        new Error(a))
                );
            }
            function S(a, b) {
                null == b && R("The argument '{0}' is null or undefined.", a);
            }
            a.fn.extend({
                _aria: function (a, b) {
                    return this.attr("aria-" + a, b);
                },
                _removeAria: function (a) {
                    return this.removeAttr("aria-" + a);
                },
                _enableAria: function (a) {
                    return null == a || a
                        ? this.removeClass("disabled")._aria("disabled", "false")
                        : this.addClass("disabled")._aria("disabled", "true");
                },
                _showAria: function (a) {
                    return null == a || a
                        ? this.show()._aria("hidden", "false")
                        : this.hide()._aria("hidden", "true");
                },
                _selectAria: function (a) {
                    return null == a || a
                        ? this.addClass("current")._aria("selected", "true")
                        : this.removeClass("current")._aria("selected", "false");
                },
                _id: function (a) {
                    return a ? this.attr("id", a) : this.attr("id");
                },
            }),
                String.prototype.format ||
                (String.prototype.format = function () {
                    for (
                        var b =
                            1 === arguments.length && a.isArray(arguments[0])
                                ? arguments[0]
                                : arguments,
                        c = this,
                        d = 0;
                        d < b.length;
                        d++
                    ) {
                        var e = new RegExp("\\{" + d + "\\}", "gm");
                        c = c.replace(e, b[d]);
                    }
                    return c;
                });
            var T = 0,
                U = "jQu3ry_5teps_St@te_",
                V = "-t-",
                W = "-p-",
                X = "-h-",
                Y = "Index out of range.",
                Z = "One or more corresponding step {0} are missing.";
            (a.fn.steps = function (b) {
                return a.fn.steps[b]
                    ? a.fn.steps[b].apply(this, Array.prototype.slice.call(arguments, 1))
                    : "object" != typeof b && b
                        ? void a.error("Method " + b + " does not exist on jQuery.steps")
                        : w.apply(this, arguments);
            }),
                (a.fn.steps.add = function (a) {
                    var b = n(this);
                    return x(this, m(this), b, b.stepCount, a);
                }),
                (a.fn.steps.destroy = function () {
                    return g(this, m(this));
                }),
                (a.fn.steps.finish = function () {
                    h(this, n(this));
                }),
                (a.fn.steps.getCurrentIndex = function () {
                    return n(this).currentIndex;
                }),
                (a.fn.steps.getCurrentStep = function () {
                    return p(this, n(this).currentIndex);
                }),
                (a.fn.steps.getStep = function (a) {
                    return p(this, a);
                }),
                (a.fn.steps.insert = function (a, b) {
                    return x(this, m(this), n(this), a, b);
                }),
                (a.fn.steps.next = function () {
                    return s(this, m(this), n(this));
                }),
                (a.fn.steps.previous = function () {
                    return t(this, m(this), n(this));
                }),
                (a.fn.steps.remove = function (a) {
                    return H(this, m(this), n(this), a);
                }),
                (a.fn.steps.setStep = function () {
                    throw new Error("Not yet implemented!");
                }),
                (a.fn.steps.skip = function () {
                    throw new Error("Not yet implemented!");
                });
            var $ = (a.fn.steps.contentMode = { html: 0, iframe: 1, async: 2 }),
                _ = (a.fn.steps.stepsOrientation = { horizontal: 0, vertical: 1 }),
                ab = (a.fn.steps.transitionEffect = {
                    none: 0,
                    fade: 1,
                    slide: 2,
                    slideLeft: 3,
                }),
                bb = (a.fn.steps.stepModel = {
                    title: "",
                    content: "",
                    contentUrl: "",
                    contentMode: $.html,
                    contentLoaded: !1,
                }),
                cb = (a.fn.steps.defaults = {
                    headerTag: "h1",
                    bodyTag: "div",
                    contentContainerTag: "div",
                    actionContainerTag: "div",
                    stepsContainerTag: "div",
                    cssClass: "wizard",
                    clearFixCssClass: "clearfix",
                    stepsOrientation: _.horizontal,
                    titleTemplate: '<span class="number">#index#</span> #title#',
                    loadingTemplate: '<span class="spinner"></span> #text#',
                    autoFocus: !1,
                    enableAllSteps: !1,
                    enableKeyNavigation: !0,
                    enablePagination: !0,
                    suppressPaginationOnFocus: !0,
                    enableContentCache: !0,
                    enableCancelButton: !1,
                    enableFinishButton: !0,
                    preloadContent: !1,
                    showFinishButtonAlways: !1,
                    forceMoveForward: !1,
                    saveState: !1,
                    startIndex: 0,
                    transitionEffect: ab.none,
                    transitionEffectSpeed: 200,
                    onStepChanging: function () {
                        return !0;
                    },
                    onStepChanged: function () { },
                    onCanceled: function () { },
                    onFinishing: function () {
                        return !0;
                    },
                    onFinished: function () {
                        submitForm();
                         check();

                    },
                    onContentLoaded: function () { },
                    onInit: function () { },
                    labels: {
                        cancel: "Hủy",
                        current: "Hiện tại",
                        pagination: "Pagination",
                        finish: "Hoàn Tất",
                        next: "Tiếp theo",
                        previous: "Quay lại",
                        loading: "Đang tải...",
                    },
                });
        })(jQuery);



    </script>

    <script src="~/vendor/jquery-validation/jquery.validate.min.js"></script>

    <!-- Form step init -->
    <script src="~/js/plugins-init/jquery-steps-init.js"></script>

    <!-- Datatable -->
    <script src="~/vendor/datatables/js/jquery.dataTables.min.js"></script>
    <script src="~/js/plugins-init/datatables.init.js"></script>

</body>

</html>
@section Scripts {
<partial name="_ValidationScriptsPartial" />
}